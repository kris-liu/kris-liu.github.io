<!DOCTYPE html><html lang="zh-CN"><head><meta name="google-site-verification" content="DVfrDhwMEodDoWVy6nv0PCpolWhBlGBSaO9hiU2r61E"><meta name="google-site-verification" content="40TgWkMJTOetJQqAMZwk5nD5rtVQRjk5i2pe6FGka5g"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="ä½‘ç¥º's Blog"><title>SpringBootå¯åŠ¨æµç¨‹è§£æ | ä½‘ç¥º's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-91282031-1','auto');ga('send','pageview');
</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">SpringBootå¯åŠ¨æµç¨‹è§£æ</h1><a id="logo" href="/.">ä½‘ç¥º's Blog</a><p class="description">Whatever you do, you have to keep moving forward!</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">SpringBootå¯åŠ¨æµç¨‹è§£æ</h1><div class="post-meta">Feb 6, 2019<span> | </span><span class="category"><a href="/categories/Spring/">Spring</a></span></div><div class="post-content"><p>SpringBootæ˜¯ç”±Pivotalå›¢é˜Ÿæä¾›çš„å…¨æ–°æ¡†æ¶ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ç”¨æ¥ç®€åŒ–æ–°Springåº”ç”¨çš„åˆå§‹æ­å»ºä»¥åŠå¼€å‘è¿‡ç¨‹ã€‚</p>
<p>ä¸‹é¢é€šè¿‡æºç æ¥äº†è§£ä¸‹SpringBootçš„å¯åŠ¨æµç¨‹ã€‚(å±•ç¤ºä»£ç åŸºäº<code>2.1.1.RELEASE</code>)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		SpringApplication.run(DemoApplication.class, args);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Spring Bootçš„å¯åŠ¨å…¥å£åœ¨<code>SpringApplication.run()</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt;[] primarySources,</span></span></div><div class="line">		String[] args) &#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> SpringApplication(primarySources).run(args);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªSpringApplicationï¼Œç„¶åæ‰§è¡Œrunæ–¹æ³•è¿›è¡Œé¡¹ç›®åˆå§‹åŒ–ã€‚</p>
<h3 id="åˆå§‹åŒ–SpringApplication"><a href="#åˆå§‹åŒ–SpringApplication" class="headerlink" title="åˆå§‹åŒ–SpringApplication"></a>åˆå§‹åŒ–SpringApplication</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.resourceLoader = resourceLoader;</div><div class="line">	Assert.notNull(primarySources, <span class="string">"PrimarySources must not be null"</span>);</div><div class="line">	<span class="keyword">this</span>.primarySources = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));</div><div class="line">	<span class="keyword">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();		setInitializers((Collection) getSpringFactoriesInstances(</div><div class="line">			ApplicationContextInitializer.class));</div><div class="line">	setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</div><div class="line">	<span class="keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¦–å…ˆæ ¹æ®é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨webå®¹å™¨ç›¸å…³çš„ç±»æ¥åˆ¤æ–­å½“å‰é¡¹ç›®æ˜¯å¦æ˜¯ä¸€ä¸ªwebé¡¹ç›®ï¼Œç„¶ååˆå§‹åŒ–<code>ApplicationContextInitializer</code>å’Œ<code>ApplicationListener</code>ï¼Œè¿™ä¸¤ç»„ç±»çš„åˆå§‹åŒ–æ˜¯é€šè¿‡<code>SpringFactoriesLoader</code>æ¥è¿›è¡Œåˆå§‹åŒ–çš„ï¼Œå…ˆçœ‹ä¸‹<code>SpringFactoriesLoader</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringFactoriesLoader</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FACTORIES_RESOURCE_LOCATION = <span class="string">"META-INF/spring.factories"</span>;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;ClassLoader, MultiValueMap&lt;String, String&gt;&gt; cache = <span class="keyword">new</span> ConcurrentReferenceHashMap&lt;&gt;();</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader)</span> </span>&#123;</div><div class="line">		String factoryClassName = factoryClass.getName();</div><div class="line">		<span class="keyword">return</span> loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(<span class="meta">@Nullable</span> ClassLoader classLoader) &#123;</div><div class="line">		MultiValueMap&lt;String, String&gt; result = cache.get(classLoader);</div><div class="line">		<span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">return</span> result;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			Enumeration&lt;URL&gt; urls = (classLoader != <span class="keyword">null</span> ?</div><div class="line">					classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :</div><div class="line">					ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));</div><div class="line">			result = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</div><div class="line">			<span class="keyword">while</span> (urls.hasMoreElements()) &#123;</div><div class="line">				URL url = urls.nextElement();</div><div class="line">				UrlResource resource = <span class="keyword">new</span> UrlResource(url);</div><div class="line">				Properties properties = PropertiesLoaderUtils.loadProperties(resource);</div><div class="line">				<span class="keyword">for</span> (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123;</div><div class="line">					String factoryClassName = ((String) entry.getKey()).trim();</div><div class="line">					<span class="keyword">for</span> (String factoryName : StringUtils.commaDelimitedListToStringArray((String) entry.getValue())) &#123;</div><div class="line">						result.add(factoryClassName, factoryName.trim());</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			cache.put(classLoader, result);</div><div class="line">			<span class="keyword">return</span> result;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (IOException ex) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unable to load factories from location ["</span> +</div><div class="line">					FACTORIES_RESOURCE_LOCATION + <span class="string">"]"</span>, ex);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>SpringFactoriesLoader</code>çš„å·¥ä½œåŸç†æ˜¯åœ¨CLASSPATHä¸‹æ¯ä¸ªJaråŒ…ä¸­çš„<code>META-INF/spring.factories</code>é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”ç±»å‹çš„å¤„ç†ç±»ã€‚</p>
<p>åœ¨åˆå§‹åŒ–SpringApplicationçš„æ—¶å€™ä½¿ç”¨<code>SpringFactoriesLoader</code>è·å–æ‰€æœ‰<code>spring.factories</code>æ–‡ä»¶ä¸­çš„<code>ApplicationContextInitializer</code>å’Œ<code>ApplicationListener</code>çš„å¤„ç†ç±»ã€‚</p>
<p><code>ApplicationContextInitializer</code>ç”¨äºåœ¨å®¹å™¨<code>refresh</code>ä¹‹å‰å¯¹å®¹å™¨è¿›è¡Œæ‰©å±•ã€‚</p>
<p><code>ApplicationListener</code>æ˜¯SpringBootçš„ç›‘å¬å™¨ï¼Œç”¨äºç›‘å¬SpringBootåº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­å„ä¸ªç¯èŠ‚å¯¹åº”çš„äº‹ä»¶(ApplicationEvent)ï¼Œä¾¿äºå¼€å‘äººå‘˜åœ¨ç‰¹å®šå¯åŠ¨ç¯èŠ‚è¿›è¡Œå®šåˆ¶åŒ–æ‰©å±•ã€‚</p>
<h3 id="æ‰§è¡ŒSpringApplicationçš„runæ–¹æ³•"><a href="#æ‰§è¡ŒSpringApplicationçš„runæ–¹æ³•" class="headerlink" title="æ‰§è¡ŒSpringApplicationçš„runæ–¹æ³•"></a>æ‰§è¡ŒSpringApplicationçš„runæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</div><div class="line">	StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</div><div class="line">	stopWatch.start();</div><div class="line">	ConfigurableApplicationContext context = <span class="keyword">null</span>;</div><div class="line">	Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">	configureHeadlessProperty();</div><div class="line">	<span class="comment">// 1</span></div><div class="line">	SpringApplicationRunListeners listeners = getRunListeners(args);</div><div class="line">	listeners.starting();</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		<span class="comment">// 2</span></div><div class="line">		ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(</div><div class="line">				args);</div><div class="line">		ConfigurableEnvironment environment = prepareEnvironment(listeners,</div><div class="line">				applicationArguments);</div><div class="line">		configureIgnoreBeanInfo(environment);</div><div class="line">		<span class="comment">// 3</span></div><div class="line">		Banner printedBanner = printBanner(environment);</div><div class="line">		<span class="comment">// 4</span></div><div class="line">		context = createApplicationContext();</div><div class="line">		<span class="comment">// 5</span></div><div class="line">		exceptionReporters = getSpringFactoriesInstances(</div><div class="line">				SpringBootExceptionReporter.class,</div><div class="line">				<span class="keyword">new</span> Class[] &#123; ConfigurableApplicationContext.class &#125;, context);</div><div class="line">		<span class="comment">// 6</span></div><div class="line">		prepareContext(context, environment, listeners, applicationArguments,</div><div class="line">				printedBanner);</div><div class="line">		<span class="comment">// 7</span></div><div class="line">		refreshContext(context);</div><div class="line">		<span class="comment">// 8</span></div><div class="line">		afterRefresh(context, applicationArguments);</div><div class="line">		stopWatch.stop();</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</div><div class="line">			<span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass)</div><div class="line">					.logStarted(getApplicationLog(), stopWatch);</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// 9</span></div><div class="line">		listeners.started(context);</div><div class="line">		<span class="comment">// 10</span></div><div class="line">		callRunners(context, applicationArguments);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">		handleRunFailure(context, ex, exceptionReporters, listeners);</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		<span class="comment">// 11</span></div><div class="line">		listeners.running(context);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">		handleRunFailure(context, ex, exceptionReporters, <span class="keyword">null</span>);</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> context;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>run</code>æ–¹æ³•æ˜¯SpringBootæ•´ä¸ªå¯åŠ¨è¿‡ç¨‹çš„æ ¸å¿ƒæµç¨‹ã€‚</p>
<ol>
<li><p>è·å–<code>SpringApplicationRunListener</code>ï¼Œ<code>SpringApplicationRunListener</code>çš„é»˜è®¤å®ç°æ˜¯<code>EventPublishingRunListener</code>ï¼Œå…¶ä½œç”¨æ˜¯ç”¨æ¥å‘å¸ƒSpringBootåº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­å„ä¸ªç¯èŠ‚å¯¹åº”çš„äº‹ä»¶(ApplicationEvent)ï¼Œç”±<code>ApplicationListener</code>æ¥ç›‘å¬å¤„ç†ï¼Œ<code>starting</code>æ–¹æ³•å°†ä¼šå‘å¸ƒ<code>ApplicationStartingEvent</code>äº‹ä»¶ã€‚</p>
</li>
<li><p>åˆ›å»ºEnvironmentï¼Œåˆå§‹åŒ–é…ç½®æ–‡ä»¶(profile)å’Œå±æ€§æ–‡ä»¶(properties)ï¼Œåˆ›å»ºå®Œæˆåä¼šå‘å¸ƒ<code>ApplicationEnvironmentPreparedEvent</code>äº‹ä»¶ã€‚</p>
</li>
<li><p>è¾“å‡ºBannerï¼ŒSpringBootå¯åŠ¨æ—¶çš„é¢æ¿æ ·å¼ã€‚</p>
</li>
<li><p>åˆ›å»ºSpringå®¹å™¨ConfigurableApplicationContextï¼Œå¦‚æœæ˜¯webé¡¹ç›®åˆ™æ˜¯<code>AnnotationConfigServletWebServerApplicationContext</code>, å¦‚æœä¸æ˜¯webé¡¹ç›®åˆ™æ˜¯<code>AnnotationConfigApplicationContext</code>ã€‚</p>
</li>
<li><p>ä»<code>SpringFactoriesLoader</code>åŠ è½½<code>SpringBootExceptionReporter</code>ç”¨äºå¤„ç†å¯åŠ¨å¼‚å¸¸ï¼Œé»˜è®¤ä¸º<code>FailureAnalyzers</code>ã€‚</p>
</li>
<li><p>æ‰§è¡Œ<code>prepareContext</code>æ–¹æ³•ï¼Œåœ¨Springå®¹å™¨åˆå§‹åŒ–å‰è¿›è¡Œé¢„å¤„ç†ã€‚</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">prepareContext</span><span class="params">(ConfigurableApplicationContext context,</span></span></div><div class="line">	ConfigurableEnvironment environment, SpringApplicationRunListeners listeners,</div><div class="line">	ApplicationArguments applicationArguments, Banner printedBanner) &#123;</div><div class="line">	context.setEnvironment(environment);</div><div class="line">	postProcessApplicationContext(context);</div><div class="line">	applyInitializers(context);</div><div class="line">	listeners.contextPrepared(context);</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</div><div class="line">		logStartupInfo(context.getParent() == <span class="keyword">null</span>);</div><div class="line">		logStartupProfileInfo(context);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// Add boot specific singleton beans</span></div><div class="line">	ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();</div><div class="line">	beanFactory.registerSingleton(<span class="string">"springApplicationArguments"</span>, applicationArguments);</div><div class="line">	<span class="keyword">if</span> (printedBanner != <span class="keyword">null</span>) &#123;</div><div class="line">		beanFactory.registerSingleton(<span class="string">"springBootBanner"</span>, printedBanner);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> DefaultListableBeanFactory) &#123;</div><div class="line">		((DefaultListableBeanFactory) beanFactory)</div><div class="line">				.setAllowBeanDefinitionOverriding(<span class="keyword">this</span>.allowBeanDefinitionOverriding);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// Load the sources</span></div><div class="line">	Set&lt;Object&gt; sources = getAllSources();</div><div class="line">	Assert.notEmpty(sources, <span class="string">"Sources must not be empty"</span>);</div><div class="line">	load(context, sources.toArray(<span class="keyword">new</span> Object[<span class="number">0</span>]));</div><div class="line">	listeners.contextLoaded(context);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>applyInitializer</code>æ–¹æ³•ç”¨äºè·å–æ‰€æœ‰çš„<code>ApplicationContextInitializer</code>ï¼Œæ‰§è¡Œå…¶<code>initialize</code>æ–¹æ³•åœ¨å®¹å™¨å¯åŠ¨å‰è¿›è¡Œæ‰©å±•ã€‚</li>
<li><code>listeners.contextPrepared(context)</code>æ–¹æ³•ç”¨äºå‘å¸ƒ<code>ApplicationContextInitializedEvent</code>äº‹ä»¶ã€‚</li>
<li><code>load</code>æ–¹æ³•ç”¨äºè§£æè¦åŠ è½½çš„beanæˆä¸ºBeanDefinitionæ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œè¿™é‡ŒåªåŠ è½½äº†é¡¹ç›®å¯åŠ¨ç±»ï¼Œä¹Ÿå°±æ˜¯<code>@SpringBootApplication</code>æ³¨è§£æ‰€åœ¨çš„beanã€‚</li>
<li><code>listeners.contextLoaded(context)</code>æ–¹æ³•ç”¨äºå‘å¸ƒ<code>ApplicationPreparedEvent</code>äº‹ä»¶ã€‚</li>
</ul>
</li>
<li><p>æ‰§è¡Œ<code>refreshContext</code>æ–¹æ³•ï¼Œåˆå§‹åŒ–Springå®¹å™¨ã€‚</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">refreshContext</span><span class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</div><div class="line">	refresh(context);</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.registerShutdownHook) &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			context.registerShutdownHook();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (AccessControlException ex) &#123;</div><div class="line">			<span class="comment">// Not allowed in some environments.</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">(ApplicationContext applicationContext)</span> </span>&#123;</div><div class="line">	Assert.isInstanceOf(AbstractApplicationContext.class, applicationContext);</div><div class="line">	((AbstractApplicationContext) applicationContext).refresh();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> è¯¥æ–¹æ³•å®é™…å°±æ˜¯æ‰§è¡ŒSpringå®¹å™¨çš„refreshæ–¹æ³•è¿›è¡Œå®¹å™¨çš„åˆå§‹åŒ–ï¼Œå¹¶æ³¨å†Œäº†é’©å­ç”¨äºé¡¹ç›®å…³é—­æ—¶ï¼Œå‘å¸ƒ<code>ContextClosedEvent</code>äº‹ä»¶ï¼Œç„¶åè¿›è¡Œå®¹å™¨é”€æ¯æ“ä½œã€‚</p>
<p> ä¸‹é¢æ˜¯Springå®¹å™¨çš„åˆå§‹åŒ–æµç¨‹ï¼ŒSpringBootåŸºäºSpringå®¹å™¨è¿›è¡Œäº†å®šåˆ¶åŒ–æ‰©å±•ï¼Œä¸»è¦é€šè¿‡ç»§æ‰¿<code>AbstractApplicationContext</code>ï¼Œä»¥åŠä½¿ç”¨Springçš„æ‰©å±•ç‚¹<code>BeanFactoryPostProcessor</code>æ¥å¯¹Springå®¹å™¨è¿›è¡Œå®šåˆ¶æ‰©å±•ï¼Œä¸‹é¢çœ‹ä¸‹ä¸»è¦çš„å˜åŒ–ç‚¹ï¼š</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</div><div class="line">	<span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</div><div class="line">		<span class="comment">// Prepare this context for refreshing.</span></div><div class="line">		prepareRefresh();</div><div class="line">	</div><div class="line">		<span class="comment">// Tell the subclass to refresh the internal bean factory.</span></div><div class="line">		ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</div><div class="line">	</div><div class="line">		<span class="comment">// Prepare the bean factory for use in this context.</span></div><div class="line">		prepareBeanFactory(beanFactory);</div><div class="line">	</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></div><div class="line">			postProcessBeanFactory(beanFactory);</div><div class="line">	</div><div class="line">			<span class="comment">// Invoke factory processors registered as beans in the context.</span></div><div class="line">			invokeBeanFactoryPostProcessors(beanFactory);</div><div class="line">	</div><div class="line">			<span class="comment">// Register bean processors that intercept bean creation.</span></div><div class="line">			registerBeanPostProcessors(beanFactory);</div><div class="line">	</div><div class="line">			<span class="comment">// Initialize message source for this context.</span></div><div class="line">			initMessageSource();</div><div class="line">	</div><div class="line">			<span class="comment">// Initialize event multicaster for this context.</span></div><div class="line">			initApplicationEventMulticaster();</div><div class="line">	</div><div class="line">			<span class="comment">// Initialize other special beans in specific context subclasses.</span></div><div class="line">			onRefresh();</div><div class="line">	</div><div class="line">			<span class="comment">// Check for listener beans and register them.</span></div><div class="line">			registerListeners();</div><div class="line">	</div><div class="line">			<span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></div><div class="line">			finishBeanFactoryInitialization(beanFactory);</div><div class="line">	</div><div class="line">			<span class="comment">// Last step: publish corresponding event.</span></div><div class="line">			finishRefresh();</div><div class="line">		&#125;</div><div class="line">	</div><div class="line">		<span class="keyword">catch</span> (BeansException ex) &#123;</div><div class="line">			<span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</div><div class="line">				logger.warn(<span class="string">"Exception encountered during context initialization - "</span> +</div><div class="line">						<span class="string">"cancelling refresh attempt: "</span> + ex);</div><div class="line">			&#125;</div><div class="line">	</div><div class="line">			<span class="comment">// Destroy already created singletons to avoid dangling resources.</span></div><div class="line">			destroyBeans();</div><div class="line">	</div><div class="line">			<span class="comment">// Reset 'active' flag.</span></div><div class="line">			cancelRefresh(ex);</div><div class="line">	</div><div class="line">			<span class="comment">// Propagate exception to caller.</span></div><div class="line">			<span class="keyword">throw</span> ex;</div><div class="line">		&#125;</div><div class="line">	</div><div class="line">		<span class="keyword">finally</span> &#123;</div><div class="line">			<span class="comment">// Reset common introspection caches in Spring's core, since we</span></div><div class="line">			<span class="comment">// might not ever need metadata for singleton beans anymore...</span></div><div class="line">			resetCommonCaches();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><code>obtainFreshBeanFactory()</code>æ–¹æ³•ç”¨äºè·å–å®¹å™¨çš„BeanFactoryï¼Œå¸¸è§„Springé¡¹ç›®çš„å®¹å™¨å®ç°è‡ª<code>AbstractRefreshableApplicationContext</code>ï¼Œåœ¨è¿™ä¸€æ­¥ä¼šè§£æxmlæ–‡ä»¶ï¼Œå°†å¾…åŠ è½½çš„beanåˆ›å»ºæˆBeanDefinitionæ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼›è€Œåœ¨SpringBooté¡¹ç›®ä¸­åˆ™å®ç°è‡ª<code>GenericApplicationContext</code>ï¼Œç”±äºSpringBooté¡¹ç›®æ²¡æœ‰xmlæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰åˆå§‹åŒ–BeanDefinitionï¼ŒSpringBootè§£æåŠ è½½beanæˆä¸ºBeanDefinitionæ˜¯é€šè¿‡<code>BeanFactoryPostProcessor</code>æ‰©å±•ç‚¹è¿›è¡Œçš„ã€‚åœ¨SpringBootå®¹å™¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šæ ¹æ®æ˜¯å¦æ˜¯webé¡¹ç›®åˆ›å»º<code>AnnotationConfigServletWebServerApplicationContext</code>æˆ–<code>AnnotationConfigApplicationContext</code>ï¼Œè¿™ä¸¤ç§å®¹å™¨åœ¨åˆ›å»ºæ—¶ä¼šé€šè¿‡<code>AnnotationConfigUtils.registerAnnotationConfigProcessors</code>æ³¨å†Œä¸€ä¸ªbeanNameä¸º<code>org.springframework.context.annotation.internalConfigurationAnnotationProcessor</code>çš„<code>BeanFactoryPostProcessor</code>ï¼Œå…·ä½“å®ç°ç±»ä¸º<code>ConfigurationClassPostProcessor</code>ï¼Œè¿™ä¸ªç±»æ˜¯SpringBootåˆå§‹åŒ–beançš„æ ¸å¿ƒç±»ã€‚</p>
</li>
<li><p><code>invokeBeanFactoryPostProcessors(beanFactory)</code>æ–¹æ³•ç”¨äºæ‰§è¡Œå¤„ç†<code>BeanFactoryPostProcessor</code>ç±»å‹æ‰©å±•ç‚¹ï¼Œè¯¥æ‰©å±•ç‚¹ç”¨äºåœ¨å®¹å™¨å®ä¾‹åŒ–å¯¹è±¡ä¹‹å‰ï¼Œå¯¹æ³¨å†Œåˆ°å®¹å™¨çš„BeanDefinitionæ‰€ä¿å­˜çš„ä¿¡æ¯åšä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ¯”å¦‚ä¿®æ”¹beanå®šä¹‰çš„æŸäº›å±æ€§æˆ–è€…å¢åŠ å…¶ä»–ä¿¡æ¯ç­‰ã€‚è¿™é‡Œå°†ä¼šæ‰§è¡Œ<code>ConfigurationClassPostProcessor</code>ã€‚</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">invokeBeanFactoryPostProcessors</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</div><div class="line">	PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());</div><div class="line">		</div><div class="line">	... ...</div><div class="line">	</div><div class="line">&#125;</div><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PostProcessorRegistrationDelegate</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">invokeBeanFactoryPostProcessors</span><span class="params">(ConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors)</span> </span>&#123;</div><div class="line">		</div><div class="line">		... ...</div><div class="line">		</div><div class="line">		List&lt;BeanDefinitionRegistryPostProcessor&gt; currentRegistryProcessors = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">		</div><div class="line">		String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">		<span class="keyword">for</span> (String ppName : postProcessorNames) &#123;</div><div class="line">			<span class="keyword">if</span> (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;</div><div class="line">				currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));</div><div class="line">				processedBeans.add(ppName);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		sortPostProcessors(currentRegistryProcessors, beanFactory);</div><div class="line">		registryProcessors.addAll(currentRegistryProcessors);</div><div class="line">		invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);</div><div class="line">		currentRegistryProcessors.clear();</div><div class="line">		</div><div class="line">		... ...</div><div class="line">			</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  è¿™é‡Œè·å–çš„<code>BeanDefinitionRegistryPostProcessor</code>å®ç°ç±»å°±æ˜¯<code>ConfigurationClassPostProcessor</code>ï¼Œæ‰§è¡Œå…¶<code>postProcessBeanDefinitionRegistry</code>æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> </span>&#123;</div><div class="line">	... ...</div><div class="line">	processConfigBeanDefinitions(registry);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processConfigBeanDefinitions</span><span class="params">(BeanDefinitionRegistry registry)</span> </span>&#123;</div><div class="line"></div><div class="line">	... ...</div><div class="line"></div><div class="line">	<span class="comment">// Parse each @Configuration class</span></div><div class="line">	ConfigurationClassParser parser = <span class="keyword">new</span> ConfigurationClassParser(</div><div class="line">			<span class="keyword">this</span>.metadataReaderFactory, <span class="keyword">this</span>.problemReporter, <span class="keyword">this</span>.environment,</div><div class="line">			<span class="keyword">this</span>.resourceLoader, <span class="keyword">this</span>.componentScanBeanNameGenerator, registry);</div><div class="line"></div><div class="line">	parser.parse(candidates);</div><div class="line">	parser.validate();</div><div class="line">	</div><div class="line">	Set&lt;ConfigurationClass&gt; configClasses = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(parser.getConfigurationClasses());</div><div class="line">	configClasses.removeAll(alreadyParsed);</div><div class="line">	</div><div class="line">	<span class="comment">// Read the model and create bean definitions based on its content</span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.reader == <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">this</span>.reader = <span class="keyword">new</span> ConfigurationClassBeanDefinitionReader(</div><div class="line">				registry, <span class="keyword">this</span>.sourceExtractor, <span class="keyword">this</span>.resourceLoader, <span class="keyword">this</span>.environment,</div><div class="line">				<span class="keyword">this</span>.importBeanNameGenerator, parser.getImportRegistry());</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">this</span>.reader.loadBeanDefinitions(configClasses);</div><div class="line">	</div><div class="line">	... ...</div><div class="line">		</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <code>ConfigurationClassPostProcessor</code>å†…éƒ¨åŠŸèƒ½ä¸»è¦æ˜¯ç”Ÿæˆ<code>ConfigurationClassParser</code>ï¼Œæ‰§è¡Œå…¶<code>parse</code>æ–¹æ³•ï¼Œç”¨æ¥è§£æç±»ä¸Šçš„å„ç§æ³¨è§£ï¼Œæ‰§è¡Œæ³¨è§£å¯¹åº”çš„å¤„ç†é€»è¾‘ï¼Œç”Ÿæˆé…ç½®ä¿¡æ¯ï¼Œæœ€åé€šè¿‡<code>reader.loadBeanDefinitions(configClasses)</code>æ–¹æ³•è§£ææˆBeanDefinitionsï¼Œè¿™é‡Œä»¥SpringBootçš„å¯åŠ¨ç±»ï¼Œä¹Ÿå°±æ˜¯<code>@SpringBootApplication</code>æ³¨è§£æ‰€åœ¨çš„ç±»ä¸ºå…¥å£è¿›è¡Œè§£æã€‚</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; configCandidates)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span> (BeanDefinitionHolder holder : configCandidates) &#123;</div><div class="line">		BeanDefinition bd = holder.getBeanDefinition();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (bd <span class="keyword">instanceof</span> AnnotatedBeanDefinition) &#123;</div><div class="line">				parse(((AnnotatedBeanDefinition) bd).getMetadata(), holder.getBeanName());</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (bd <span class="keyword">instanceof</span> AbstractBeanDefinition &amp;&amp; ((AbstractBeanDefinition) bd).hasBeanClass()) &#123;</div><div class="line">				parse(((AbstractBeanDefinition) bd).getBeanClass(), holder.getBeanName());</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> &#123;</div><div class="line">				parse(bd.getBeanClassName(), holder.getBeanName());</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (BeanDefinitionStoreException ex) &#123;</div><div class="line">			<span class="keyword">throw</span> ex;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> BeanDefinitionStoreException(</div><div class="line">					<span class="string">"Failed to parse configuration class ["</span> + bd.getBeanClassName() + <span class="string">"]"</span>, ex);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">	<span class="keyword">this</span>.deferredImportSelectorHandler.process();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <code>parse</code>æ–¹æ³•ç”¨äºè§£æå„ç§æ³¨è§£ï¼š<code>@ComponentScan</code>ã€<code>@ComponentScans</code>ã€<code>@Configuration</code>ã€<code>@Component</code>ã€<code>@Bean</code>ã€<code>@Import</code>ã€<code>@ImportResource</code>ã€<code>@PropertySource</code>ã€‚</p>
<p>  <code>deferredImportSelectorHandler.process()</code>æ–¹æ³•ç”¨æ¥å¤„ç†è‡ªåŠ¨é…ç½®åŠŸèƒ½ã€‚ä¸»è¦é€šè¿‡<code>AutoConfigurationImportSelector</code>æ¥å¤„ç†ï¼Œè¯¥ç±»æ˜¯é€šè¿‡<code>@SpringBootApplication</code>æ³¨è§£ä¸Šçš„<code>@Import</code>æ³¨è§£å¯¼å…¥çš„ï¼Œ<code>AutoConfigurationImportSelector</code>é€šè¿‡<code>SpringFactoriesLoader</code>è·å–æ‰€æœ‰<code>spring.factories</code>æ–‡ä»¶ä¸­çš„<code>EnableAutoConfiguration</code>ç±»å‹è‡ªåŠ¨é…ç½®ç±»ï¼Œæ ¹æ®ç±»ä¸Šçš„<code>@Conditional</code>ç³»åˆ—æ³¨è§£ï¼Œè¿‡æ»¤æ‰ä¸éœ€è¦åŠ è½½çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå°†å‰©ä½™éœ€è¦åŠ è½½çš„è‡ªåŠ¨é…ç½®ç±»è¿›è¡Œåˆå§‹åŒ–è§£æã€‚</p>
</li>
<li><p><code>onRefresh()</code>æ–¹æ³•ç”¨äºåˆ›å»ºwebå®¹å™¨ï¼Œå¦‚æœæ˜¯webé¡¹ç›®ï¼Œåˆ™å®¹å™¨ç»§æ‰¿äº<code>ServletWebServerApplicationContext</code>ï¼Œå°†ä¼šåœ¨è¿™ä¸€æ­¥åˆ›å»ºwebå®¹å™¨ã€‚</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.onRefresh();</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		createWebServer();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">"Unable to start web server"</span>, ex);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p><code>finishRefresh()</code>æ–¹æ³•ç”¨äºå¯åŠ¨webå®¹å™¨ï¼Œå¦‚æœæ˜¯webé¡¹ç›®ï¼Œåˆ™å®¹å™¨ç»§æ‰¿äº<code>ServletWebServerApplicationContext</code>ï¼Œå°†ä¼šåœ¨è¿™ä¸€æ­¥å¯åŠ¨webå®¹å™¨ï¼Œå¹¶å‘å¸ƒ<code>ServletWebServerInitializedEvent</code>äº‹ä»¶ã€‚</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finishRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.finishRefresh();</div><div class="line">	WebServer webServer = startWebServer();</div><div class="line">	<span class="keyword">if</span> (webServer != <span class="keyword">null</span>) &#123;</div><div class="line">		publishEvent(<span class="keyword">new</span> ServletWebServerInitializedEvent(webServer, <span class="keyword">this</span>));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>æ‰§è¡Œ<code>afterRefresh</code>æ¥åœ¨Springå®¹å™¨åˆå§‹åŒ–å®Œæˆåè¿›è¡Œæ‰©å±•ï¼Œé»˜è®¤æ²¡æœ‰å®ç°ã€‚</p>
</li>
<li><p>å‘å¸ƒ<code>ApplicationStartedEvent</code>äº‹ä»¶ã€‚</p>
</li>
<li><p>è·å–å®¹å™¨ä¸­çš„<code>ApplicationRunner</code>å’Œ<code>CommandLineRunner</code>ï¼Œæ‰§è¡Œå…¶<code>run</code>æ–¹æ³•ï¼Œç”¨äºåœ¨å¯åŠ¨å®Œæˆå‰è¿›è¡Œæ‰©å±•ã€‚</p>
</li>
<li><p>å‘å¸ƒ<code>ApplicationReadyEvent</code>äº‹ä»¶ã€‚</p>
</li>
</ol>
<p>è‡³æ­¤SpringBootå¯åŠ¨å®Œæˆã€‚ä»æ•´ä¸ªå¯åŠ¨æµç¨‹æ¥çœ‹ï¼ŒSpringBootçš„æ ¸å¿ƒå°±æ˜¯åœ¨Springå®¹å™¨åˆå§‹åŒ–çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡Springçš„æ‰©å±•ç‚¹è¿›è¡Œäº†å®šåˆ¶åŒ–æ‰©å±•ï¼Œå¹¶è¿›è¡Œäº†ä¸€å±‚åŒ…è£…ã€‚ä¸»è¦é€šè¿‡ç»§æ‰¿<code>AbstractApplicationContext</code>ï¼Œä»¥åŠä½¿ç”¨Springçš„æ‰©å±•ç‚¹<code>BeanFactoryPostProcessor</code>è¿›è¡Œæ‰©å±•ï¼Œå¹¶æ–°å¢äº†<code>ApplicationContextInitializer</code>å’Œ<code>ApplicationListener</code>è¿›è¡Œæ‰©å±•ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™:"></a>å‚è€ƒèµ„æ–™:</h2><p><a href="https://www.jianshu.com/p/83693d3d0a65" target="_blank" rel="external">ç»™ä½ ä¸€ä»½Spring BootçŸ¥è¯†æ¸…å•</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://blogxin.cn/2019/02/06/spring-boot-init/" data-id="ck9txwat9004ojar0hu8t0f47" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACIUlEQVR42u3aQZKDMAwEwP3/p7MPSMLOyGGrYrdPFBBCc1BJln5+4vV4Ws9X8zPXx8+//djCwMD4Wsbjcs0Y1/+Sf6bk3TAwMM5hvHt0Gxbbq+/O5O+GgYGBcZ3qXQfKPJgmJAwMDIxPMdbxGBgYGCtFbFKyrm+03V6LY2BgfCEj33X//+Nb+hsYGBhfxXiU6770MQ+yL56DgYGxNWPWgJwh8wbDsCGKgYGxNSNpMbYPTYYzZq2C6K0wMDAOYNwx1JXcOUs9MTAwzmHkoW022pWE4PyzYmBgnMNoA+IdqV4LeFuFY2BgbMpoN/ET0qzQbYP7cF8QAwPjCxl5SF1pWyYtgTbov0gNMTAwNmXkhWI+NpG3KlveUicWAwNjI0ab6s2u5qMYRUqKgYGxNWNl6y0JzSvJ37AHi4GBsRFj1gBYOf5sC6FuYWJgYGzBmG2ctYlm3iiNGpwYGBgHMFpSOyTRvlb9cTEwMLZm5G2ANu2bJXwrZS0GBsbejDbty8+vlLX1qAcGBsYxjDoJGw1PJKVvPYSBgYFxACPfuB+OQSwMdiRhHQMDY1fGo1z5QNhs8CJvSGBgYJzDmAW7tvjMW56zohoDA+MExizIrmz3t58seiYGBsYBjHZDP28VtJ9ghsTAwMDI07VZAM2f/MemGwYGBkYwJJEUt+3QRnQnBgbGAYz85dYD66dGOjAwMM5h5D/L78kDbhLuk009DAyMTRm/WwOJhzSxh9IAAAAASUVORK5CYII=">åˆ†äº«</a><div class="tags"><a href="/tags/Spring/">Spring</a><a href="/tags/SpringBoot/">SpringBoot</a></div><div class="post-nav"><a class="pre" href="/2019/03/02/multi-datacenter/">å¤šæ´»æ¶æ„æ€è€ƒæ€»ç»“</a><a class="next" href="/2018/11/15/OOM-killer/">çº¿ä¸ŠJavaè¿›ç¨‹æ¶ˆå¤±æ’æŸ¥åˆ†æ</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: '530c0141e83989b1dc02',
  clientSecret: '89e61ba0adc9b0c630bcc2641c791bfd7ef9faea',
  repo: 'kris-liu.github.io',
  owner: 'kris-liu',
  admin: ['kris-liu'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blogxin.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Concurrent/">Concurrent</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IO-NIO/">IO&NIO</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MQ/">MQ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Netty/">Netty</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat/">Tomcat</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/æ¶æ„/">æ¶æ„</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/çº¿ä¸Šé—®é¢˜/">çº¿ä¸Šé—®é¢˜</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/å†…å­˜æ³„æ¼/" style="font-size: 15px;">å†…å­˜æ³„æ¼</a> <a href="/tags/æ¶æ„/" style="font-size: 15px;">æ¶æ„</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/GC/" style="font-size: 15px;">GC</a> <a href="/tags/çº¿ä¸Šé—®é¢˜/" style="font-size: 15px;">çº¿ä¸Šé—®é¢˜</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/IO/" style="font-size: 15px;">IO</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/å¹¶å‘/" style="font-size: 15px;">å¹¶å‘</a> <a href="/tags/é”/" style="font-size: 15px;">é”</a> <a href="/tags/æºç /" style="font-size: 15px;">æºç </a> <a href="/tags/Transaction/" style="font-size: 15px;">Transaction</a> <a href="/tags/å¼‚æ­¥/" style="font-size: 15px;">å¼‚æ­¥</a> <a href="/tags/è¯»å†™é”/" style="font-size: 15px;">è¯»å†™é”</a> <a href="/tags/ç¼“å­˜/" style="font-size: 15px;">ç¼“å­˜</a> <a href="/tags/çº¿ç¨‹æ± /" style="font-size: 15px;">çº¿ç¨‹æ± </a> <a href="/tags/BIO/" style="font-size: 15px;">BIO</a> <a href="/tags/AIO/" style="font-size: 15px;">AIO</a> <a href="/tags/JMM/" style="font-size: 15px;">JMM</a> <a href="/tags/å†…å­˜æ¨¡å‹/" style="font-size: 15px;">å†…å­˜æ¨¡å‹</a> <a href="/tags/Netty/" style="font-size: 15px;">Netty</a> <a href="/tags/Tomcat/" style="font-size: 15px;">Tomcat</a> <a href="/tags/MQ/" style="font-size: 15px;">MQ</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/MyBatis/" style="font-size: 15px;">MyBatis</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/04/Distributed-Transaction-2/">ä»é›¶å¼€å§‹å†™ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶(äºŒ)-æ¶æ„</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/16/Distributed-Transaction-1/">ä»é›¶å¼€å§‹å†™ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶(ä¸€)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/01/sharding-db/">åŸºäºSpring+MyBatiså®ç°ä¸€ä¸ªåˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»åŠŸèƒ½çš„å·¥å…·åº“</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/02/multi-datacenter/">å¤šæ´»æ¶æ„æ€è€ƒæ€»ç»“</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/06/spring-boot-init/">SpringBootå¯åŠ¨æµç¨‹è§£æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/15/OOM-killer/">çº¿ä¸ŠJavaè¿›ç¨‹æ¶ˆå¤±æ’æŸ¥åˆ†æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/30/Distributed-Consistency/">åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜å¸¸è§è§£å†³æ–¹æ¡ˆ</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/kafka-block/">ç”±ä¸€æ¬¡kafkaæ¶ˆè´¹ç«¯æ¶ˆæ¯é˜»å¡é—®é¢˜åˆ†ækafkaæ¶ˆè´¹ç«¯çº¿ç¨‹æ¨¡å‹</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/29/TransactionMessage/">äº‹åŠ¡æ¶ˆæ¯å®ç°åŸç†</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/23/Distributed-Transaction/">åˆ†å¸ƒå¼äº‹åŠ¡</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="http://blog.csdn.net/xx_ytm" title="æˆ‘çš„CSDNåšå®¢" target="_blank">æˆ‘çš„CSDNåšå®¢</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2020 <a href="/." rel="nofollow">ä½‘ç¥º's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>