<!DOCTYPE html><html lang="zh-CN"><head><meta name="google-site-verification" content="DVfrDhwMEodDoWVy6nv0PCpolWhBlGBSaO9hiU2r61E"><meta name="google-site-verification" content="40TgWkMJTOetJQqAMZwk5nD5rtVQRjk5i2pe6FGka5g"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="佑祺's Blog"><title>SpringBoot启动流程解析 | 佑祺's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-91282031-1','auto');ga('send','pageview');
</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">SpringBoot启动流程解析</h1><a id="logo" href="/.">佑祺's Blog</a><p class="description">Whatever you do, you have to keep moving forward!</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">SpringBoot启动流程解析</h1><div class="post-meta">Feb 6, 2019<span> | </span><span class="category"><a href="/categories/Spring/">Spring</a></span></div><div class="post-content"><p>SpringBoot是由Pivotal团队提供的全新框架，其设计目的是用来简化新Spring应用的初始搭建以及开发过程。</p>
<p>下面通过源码来了解下SpringBoot的启动流程。(展示代码基于<code>2.1.1.RELEASE</code>)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		SpringApplication.run(DemoApplication.class, args);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Spring Boot的启动入口在<code>SpringApplication.run()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt;[] primarySources,</span></span></div><div class="line">		String[] args) &#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> SpringApplication(primarySources).run(args);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>首先创建一个SpringApplication，然后执行run方法进行项目初始化。</p>
<h3 id="初始化SpringApplication"><a href="#初始化SpringApplication" class="headerlink" title="初始化SpringApplication"></a>初始化SpringApplication</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.resourceLoader = resourceLoader;</div><div class="line">	Assert.notNull(primarySources, <span class="string">"PrimarySources must not be null"</span>);</div><div class="line">	<span class="keyword">this</span>.primarySources = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));</div><div class="line">	<span class="keyword">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();		setInitializers((Collection) getSpringFactoriesInstances(</div><div class="line">			ApplicationContextInitializer.class));</div><div class="line">	setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</div><div class="line">	<span class="keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>首先根据项目中是否存在web容器相关的类来判断当前项目是否是一个web项目，然后初始化<code>ApplicationContextInitializer</code>和<code>ApplicationListener</code>，这两组类的初始化是通过<code>SpringFactoriesLoader</code>来进行初始化的，先看下<code>SpringFactoriesLoader</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringFactoriesLoader</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FACTORIES_RESOURCE_LOCATION = <span class="string">"META-INF/spring.factories"</span>;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;ClassLoader, MultiValueMap&lt;String, String&gt;&gt; cache = <span class="keyword">new</span> ConcurrentReferenceHashMap&lt;&gt;();</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader)</span> </span>&#123;</div><div class="line">		String factoryClassName = factoryClass.getName();</div><div class="line">		<span class="keyword">return</span> loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(<span class="meta">@Nullable</span> ClassLoader classLoader) &#123;</div><div class="line">		MultiValueMap&lt;String, String&gt; result = cache.get(classLoader);</div><div class="line">		<span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">return</span> result;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			Enumeration&lt;URL&gt; urls = (classLoader != <span class="keyword">null</span> ?</div><div class="line">					classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :</div><div class="line">					ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));</div><div class="line">			result = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</div><div class="line">			<span class="keyword">while</span> (urls.hasMoreElements()) &#123;</div><div class="line">				URL url = urls.nextElement();</div><div class="line">				UrlResource resource = <span class="keyword">new</span> UrlResource(url);</div><div class="line">				Properties properties = PropertiesLoaderUtils.loadProperties(resource);</div><div class="line">				<span class="keyword">for</span> (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123;</div><div class="line">					String factoryClassName = ((String) entry.getKey()).trim();</div><div class="line">					<span class="keyword">for</span> (String factoryName : StringUtils.commaDelimitedListToStringArray((String) entry.getValue())) &#123;</div><div class="line">						result.add(factoryClassName, factoryName.trim());</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			cache.put(classLoader, result);</div><div class="line">			<span class="keyword">return</span> result;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (IOException ex) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unable to load factories from location ["</span> +</div><div class="line">					FACTORIES_RESOURCE_LOCATION + <span class="string">"]"</span>, ex);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>SpringFactoriesLoader</code>的工作原理是在CLASSPATH下每个Jar包中的<code>META-INF/spring.factories</code>配置文件中找到对应类型的处理类。</p>
<p>在初始化SpringApplication的时候使用<code>SpringFactoriesLoader</code>获取所有<code>spring.factories</code>文件中的<code>ApplicationContextInitializer</code>和<code>ApplicationListener</code>的处理类。</p>
<p><code>ApplicationContextInitializer</code>用于在容器<code>refresh</code>之前对容器进行扩展。</p>
<p><code>ApplicationListener</code>是SpringBoot的监听器，用于监听SpringBoot应用启动过程中各个环节对应的事件(ApplicationEvent)，便于开发人员在特定启动环节进行定制化扩展。</p>
<h3 id="执行SpringApplication的run方法"><a href="#执行SpringApplication的run方法" class="headerlink" title="执行SpringApplication的run方法"></a>执行SpringApplication的run方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</div><div class="line">	StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</div><div class="line">	stopWatch.start();</div><div class="line">	ConfigurableApplicationContext context = <span class="keyword">null</span>;</div><div class="line">	Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">	configureHeadlessProperty();</div><div class="line">	<span class="comment">// 1</span></div><div class="line">	SpringApplicationRunListeners listeners = getRunListeners(args);</div><div class="line">	listeners.starting();</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		<span class="comment">// 2</span></div><div class="line">		ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(</div><div class="line">				args);</div><div class="line">		ConfigurableEnvironment environment = prepareEnvironment(listeners,</div><div class="line">				applicationArguments);</div><div class="line">		configureIgnoreBeanInfo(environment);</div><div class="line">		<span class="comment">// 3</span></div><div class="line">		Banner printedBanner = printBanner(environment);</div><div class="line">		<span class="comment">// 4</span></div><div class="line">		context = createApplicationContext();</div><div class="line">		<span class="comment">// 5</span></div><div class="line">		exceptionReporters = getSpringFactoriesInstances(</div><div class="line">				SpringBootExceptionReporter.class,</div><div class="line">				<span class="keyword">new</span> Class[] &#123; ConfigurableApplicationContext.class &#125;, context);</div><div class="line">		<span class="comment">// 6</span></div><div class="line">		prepareContext(context, environment, listeners, applicationArguments,</div><div class="line">				printedBanner);</div><div class="line">		<span class="comment">// 7</span></div><div class="line">		refreshContext(context);</div><div class="line">		<span class="comment">// 8</span></div><div class="line">		afterRefresh(context, applicationArguments);</div><div class="line">		stopWatch.stop();</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</div><div class="line">			<span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass)</div><div class="line">					.logStarted(getApplicationLog(), stopWatch);</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// 9</span></div><div class="line">		listeners.started(context);</div><div class="line">		<span class="comment">// 10</span></div><div class="line">		callRunners(context, applicationArguments);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">		handleRunFailure(context, ex, exceptionReporters, listeners);</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		<span class="comment">// 11</span></div><div class="line">		listeners.running(context);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">		handleRunFailure(context, ex, exceptionReporters, <span class="keyword">null</span>);</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> context;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>run</code>方法是SpringBoot整个启动过程的核心流程。</p>
<ol>
<li><p>获取<code>SpringApplicationRunListener</code>，<code>SpringApplicationRunListener</code>的默认实现是<code>EventPublishingRunListener</code>，其作用是用来发布SpringBoot应用启动过程中各个环节对应的事件(ApplicationEvent)，由<code>ApplicationListener</code>来监听处理，<code>starting</code>方法将会发布<code>ApplicationStartingEvent</code>事件。</p>
</li>
<li><p>创建Environment，初始化配置文件(profile)和属性文件(properties)，创建完成后会发布<code>ApplicationEnvironmentPreparedEvent</code>事件。</p>
</li>
<li><p>输出Banner，SpringBoot启动时的面板样式。</p>
</li>
<li><p>创建Spring容器ConfigurableApplicationContext，如果是web项目则是<code>AnnotationConfigServletWebServerApplicationContext</code>, 如果不是web项目则是<code>AnnotationConfigApplicationContext</code>。</p>
</li>
<li><p>从<code>SpringFactoriesLoader</code>加载<code>SpringBootExceptionReporter</code>用于处理启动异常，默认为<code>FailureAnalyzers</code>。</p>
</li>
<li><p>执行<code>prepareContext</code>方法，在Spring容器初始化前进行预处理。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">prepareContext</span><span class="params">(ConfigurableApplicationContext context,</span></span></div><div class="line">	ConfigurableEnvironment environment, SpringApplicationRunListeners listeners,</div><div class="line">	ApplicationArguments applicationArguments, Banner printedBanner) &#123;</div><div class="line">	context.setEnvironment(environment);</div><div class="line">	postProcessApplicationContext(context);</div><div class="line">	applyInitializers(context);</div><div class="line">	listeners.contextPrepared(context);</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</div><div class="line">		logStartupInfo(context.getParent() == <span class="keyword">null</span>);</div><div class="line">		logStartupProfileInfo(context);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// Add boot specific singleton beans</span></div><div class="line">	ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();</div><div class="line">	beanFactory.registerSingleton(<span class="string">"springApplicationArguments"</span>, applicationArguments);</div><div class="line">	<span class="keyword">if</span> (printedBanner != <span class="keyword">null</span>) &#123;</div><div class="line">		beanFactory.registerSingleton(<span class="string">"springBootBanner"</span>, printedBanner);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> DefaultListableBeanFactory) &#123;</div><div class="line">		((DefaultListableBeanFactory) beanFactory)</div><div class="line">				.setAllowBeanDefinitionOverriding(<span class="keyword">this</span>.allowBeanDefinitionOverriding);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// Load the sources</span></div><div class="line">	Set&lt;Object&gt; sources = getAllSources();</div><div class="line">	Assert.notEmpty(sources, <span class="string">"Sources must not be empty"</span>);</div><div class="line">	load(context, sources.toArray(<span class="keyword">new</span> Object[<span class="number">0</span>]));</div><div class="line">	listeners.contextLoaded(context);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>applyInitializer</code>方法用于获取所有的<code>ApplicationContextInitializer</code>，执行其<code>initialize</code>方法在容器启动前进行扩展。</li>
<li><code>listeners.contextPrepared(context)</code>方法用于发布<code>ApplicationContextInitializedEvent</code>事件。</li>
<li><code>load</code>方法用于解析要加载的bean成为BeanDefinition注册到容器中，这里只加载了项目启动类，也就是<code>@SpringBootApplication</code>注解所在的bean。</li>
<li><code>listeners.contextLoaded(context)</code>方法用于发布<code>ApplicationPreparedEvent</code>事件。</li>
</ul>
</li>
<li><p>执行<code>refreshContext</code>方法，初始化Spring容器。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">refreshContext</span><span class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</div><div class="line">	refresh(context);</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.registerShutdownHook) &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			context.registerShutdownHook();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (AccessControlException ex) &#123;</div><div class="line">			<span class="comment">// Not allowed in some environments.</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">(ApplicationContext applicationContext)</span> </span>&#123;</div><div class="line">	Assert.isInstanceOf(AbstractApplicationContext.class, applicationContext);</div><div class="line">	((AbstractApplicationContext) applicationContext).refresh();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 该方法实际就是执行Spring容器的refresh方法进行容器的初始化，并注册了钩子用于项目关闭时，发布<code>ContextClosedEvent</code>事件，然后进行容器销毁操作。</p>
<p> 下面是Spring容器的初始化流程，SpringBoot基于Spring容器进行了定制化扩展，主要通过继承<code>AbstractApplicationContext</code>，以及使用Spring的扩展点<code>BeanFactoryPostProcessor</code>来对Spring容器进行定制扩展，下面看下主要的变化点：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</div><div class="line">	<span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</div><div class="line">		<span class="comment">// Prepare this context for refreshing.</span></div><div class="line">		prepareRefresh();</div><div class="line">	</div><div class="line">		<span class="comment">// Tell the subclass to refresh the internal bean factory.</span></div><div class="line">		ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</div><div class="line">	</div><div class="line">		<span class="comment">// Prepare the bean factory for use in this context.</span></div><div class="line">		prepareBeanFactory(beanFactory);</div><div class="line">	</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></div><div class="line">			postProcessBeanFactory(beanFactory);</div><div class="line">	</div><div class="line">			<span class="comment">// Invoke factory processors registered as beans in the context.</span></div><div class="line">			invokeBeanFactoryPostProcessors(beanFactory);</div><div class="line">	</div><div class="line">			<span class="comment">// Register bean processors that intercept bean creation.</span></div><div class="line">			registerBeanPostProcessors(beanFactory);</div><div class="line">	</div><div class="line">			<span class="comment">// Initialize message source for this context.</span></div><div class="line">			initMessageSource();</div><div class="line">	</div><div class="line">			<span class="comment">// Initialize event multicaster for this context.</span></div><div class="line">			initApplicationEventMulticaster();</div><div class="line">	</div><div class="line">			<span class="comment">// Initialize other special beans in specific context subclasses.</span></div><div class="line">			onRefresh();</div><div class="line">	</div><div class="line">			<span class="comment">// Check for listener beans and register them.</span></div><div class="line">			registerListeners();</div><div class="line">	</div><div class="line">			<span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></div><div class="line">			finishBeanFactoryInitialization(beanFactory);</div><div class="line">	</div><div class="line">			<span class="comment">// Last step: publish corresponding event.</span></div><div class="line">			finishRefresh();</div><div class="line">		&#125;</div><div class="line">	</div><div class="line">		<span class="keyword">catch</span> (BeansException ex) &#123;</div><div class="line">			<span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</div><div class="line">				logger.warn(<span class="string">"Exception encountered during context initialization - "</span> +</div><div class="line">						<span class="string">"cancelling refresh attempt: "</span> + ex);</div><div class="line">			&#125;</div><div class="line">	</div><div class="line">			<span class="comment">// Destroy already created singletons to avoid dangling resources.</span></div><div class="line">			destroyBeans();</div><div class="line">	</div><div class="line">			<span class="comment">// Reset 'active' flag.</span></div><div class="line">			cancelRefresh(ex);</div><div class="line">	</div><div class="line">			<span class="comment">// Propagate exception to caller.</span></div><div class="line">			<span class="keyword">throw</span> ex;</div><div class="line">		&#125;</div><div class="line">	</div><div class="line">		<span class="keyword">finally</span> &#123;</div><div class="line">			<span class="comment">// Reset common introspection caches in Spring's core, since we</span></div><div class="line">			<span class="comment">// might not ever need metadata for singleton beans anymore...</span></div><div class="line">			resetCommonCaches();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><code>obtainFreshBeanFactory()</code>方法用于获取容器的BeanFactory，常规Spring项目的容器实现自<code>AbstractRefreshableApplicationContext</code>，在这一步会解析xml文件，将待加载的bean创建成BeanDefinition注册到容器中；而在SpringBoot项目中则实现自<code>GenericApplicationContext</code>，由于SpringBoot项目没有xml文件，所以这里没有初始化BeanDefinition，SpringBoot解析加载bean成为BeanDefinition是通过<code>BeanFactoryPostProcessor</code>扩展点进行的。在SpringBoot容器创建的时候，会根据是否是web项目创建<code>AnnotationConfigServletWebServerApplicationContext</code>或<code>AnnotationConfigApplicationContext</code>，这两种容器在创建时会通过<code>AnnotationConfigUtils.registerAnnotationConfigProcessors</code>注册一个beanName为<code>org.springframework.context.annotation.internalConfigurationAnnotationProcessor</code>的<code>BeanFactoryPostProcessor</code>，具体实现类为<code>ConfigurationClassPostProcessor</code>，这个类是SpringBoot初始化bean的核心类。</p>
</li>
<li><p><code>invokeBeanFactoryPostProcessors(beanFactory)</code>方法用于执行处理<code>BeanFactoryPostProcessor</code>类型扩展点，该扩展点用于在容器实例化对象之前，对注册到容器的BeanDefinition所保存的信息做一些额外的操作，比如修改bean定义的某些属性或者增加其他信息等。这里将会执行<code>ConfigurationClassPostProcessor</code>。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">invokeBeanFactoryPostProcessors</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</div><div class="line">	PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());</div><div class="line">		</div><div class="line">	... ...</div><div class="line">	</div><div class="line">&#125;</div><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PostProcessorRegistrationDelegate</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">invokeBeanFactoryPostProcessors</span><span class="params">(ConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors)</span> </span>&#123;</div><div class="line">		</div><div class="line">		... ...</div><div class="line">		</div><div class="line">		List&lt;BeanDefinitionRegistryPostProcessor&gt; currentRegistryProcessors = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">		</div><div class="line">		String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">		<span class="keyword">for</span> (String ppName : postProcessorNames) &#123;</div><div class="line">			<span class="keyword">if</span> (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;</div><div class="line">				currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));</div><div class="line">				processedBeans.add(ppName);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		sortPostProcessors(currentRegistryProcessors, beanFactory);</div><div class="line">		registryProcessors.addAll(currentRegistryProcessors);</div><div class="line">		invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);</div><div class="line">		currentRegistryProcessors.clear();</div><div class="line">		</div><div class="line">		... ...</div><div class="line">			</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  这里获取的<code>BeanDefinitionRegistryPostProcessor</code>实现类就是<code>ConfigurationClassPostProcessor</code>，执行其<code>postProcessBeanDefinitionRegistry</code>方法进行处理。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> </span>&#123;</div><div class="line">	... ...</div><div class="line">	processConfigBeanDefinitions(registry);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processConfigBeanDefinitions</span><span class="params">(BeanDefinitionRegistry registry)</span> </span>&#123;</div><div class="line"></div><div class="line">	... ...</div><div class="line"></div><div class="line">	<span class="comment">// Parse each @Configuration class</span></div><div class="line">	ConfigurationClassParser parser = <span class="keyword">new</span> ConfigurationClassParser(</div><div class="line">			<span class="keyword">this</span>.metadataReaderFactory, <span class="keyword">this</span>.problemReporter, <span class="keyword">this</span>.environment,</div><div class="line">			<span class="keyword">this</span>.resourceLoader, <span class="keyword">this</span>.componentScanBeanNameGenerator, registry);</div><div class="line"></div><div class="line">	parser.parse(candidates);</div><div class="line">	parser.validate();</div><div class="line">	</div><div class="line">	Set&lt;ConfigurationClass&gt; configClasses = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(parser.getConfigurationClasses());</div><div class="line">	configClasses.removeAll(alreadyParsed);</div><div class="line">	</div><div class="line">	<span class="comment">// Read the model and create bean definitions based on its content</span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.reader == <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">this</span>.reader = <span class="keyword">new</span> ConfigurationClassBeanDefinitionReader(</div><div class="line">				registry, <span class="keyword">this</span>.sourceExtractor, <span class="keyword">this</span>.resourceLoader, <span class="keyword">this</span>.environment,</div><div class="line">				<span class="keyword">this</span>.importBeanNameGenerator, parser.getImportRegistry());</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">this</span>.reader.loadBeanDefinitions(configClasses);</div><div class="line">	</div><div class="line">	... ...</div><div class="line">		</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <code>ConfigurationClassPostProcessor</code>内部功能主要是生成<code>ConfigurationClassParser</code>，执行其<code>parse</code>方法，用来解析类上的各种注解，执行注解对应的处理逻辑，生成配置信息，最后通过<code>reader.loadBeanDefinitions(configClasses)</code>方法解析成BeanDefinitions，这里以SpringBoot的启动类，也就是<code>@SpringBootApplication</code>注解所在的类为入口进行解析。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; configCandidates)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span> (BeanDefinitionHolder holder : configCandidates) &#123;</div><div class="line">		BeanDefinition bd = holder.getBeanDefinition();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (bd <span class="keyword">instanceof</span> AnnotatedBeanDefinition) &#123;</div><div class="line">				parse(((AnnotatedBeanDefinition) bd).getMetadata(), holder.getBeanName());</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (bd <span class="keyword">instanceof</span> AbstractBeanDefinition &amp;&amp; ((AbstractBeanDefinition) bd).hasBeanClass()) &#123;</div><div class="line">				parse(((AbstractBeanDefinition) bd).getBeanClass(), holder.getBeanName());</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> &#123;</div><div class="line">				parse(bd.getBeanClassName(), holder.getBeanName());</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (BeanDefinitionStoreException ex) &#123;</div><div class="line">			<span class="keyword">throw</span> ex;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> BeanDefinitionStoreException(</div><div class="line">					<span class="string">"Failed to parse configuration class ["</span> + bd.getBeanClassName() + <span class="string">"]"</span>, ex);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">	<span class="keyword">this</span>.deferredImportSelectorHandler.process();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <code>parse</code>方法用于解析各种注解：<code>@ComponentScan</code>、<code>@ComponentScans</code>、<code>@Configuration</code>、<code>@Component</code>、<code>@Bean</code>、<code>@Import</code>、<code>@ImportResource</code>、<code>@PropertySource</code>。</p>
<p>  <code>deferredImportSelectorHandler.process()</code>方法用来处理自动配置功能。主要通过<code>AutoConfigurationImportSelector</code>来处理，该类是通过<code>@SpringBootApplication</code>注解上的<code>@Import</code>注解导入的，<code>AutoConfigurationImportSelector</code>通过<code>SpringFactoriesLoader</code>获取所有<code>spring.factories</code>文件中的<code>EnableAutoConfiguration</code>类型自动配置类，根据类上的<code>@Conditional</code>系列注解，过滤掉不需要加载的自动配置类，将剩余需要加载的自动配置类进行初始化解析。</p>
</li>
<li><p><code>onRefresh()</code>方法用于创建web容器，如果是web项目，则容器继承于<code>ServletWebServerApplicationContext</code>，将会在这一步创建web容器。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.onRefresh();</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		createWebServer();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">"Unable to start web server"</span>, ex);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p><code>finishRefresh()</code>方法用于启动web容器，如果是web项目，则容器继承于<code>ServletWebServerApplicationContext</code>，将会在这一步启动web容器，并发布<code>ServletWebServerInitializedEvent</code>事件。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finishRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.finishRefresh();</div><div class="line">	WebServer webServer = startWebServer();</div><div class="line">	<span class="keyword">if</span> (webServer != <span class="keyword">null</span>) &#123;</div><div class="line">		publishEvent(<span class="keyword">new</span> ServletWebServerInitializedEvent(webServer, <span class="keyword">this</span>));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>执行<code>afterRefresh</code>来在Spring容器初始化完成后进行扩展，默认没有实现。</p>
</li>
<li><p>发布<code>ApplicationStartedEvent</code>事件。</p>
</li>
<li><p>获取容器中的<code>ApplicationRunner</code>和<code>CommandLineRunner</code>，执行其<code>run</code>方法，用于在启动完成前进行扩展。</p>
</li>
<li><p>发布<code>ApplicationReadyEvent</code>事件。</p>
</li>
</ol>
<p>至此SpringBoot启动完成。从整个启动流程来看，SpringBoot的核心就是在Spring容器初始化的基础上，通过Spring的扩展点进行了定制化扩展，并进行了一层包装。主要通过继承<code>AbstractApplicationContext</code>，以及使用Spring的扩展点<code>BeanFactoryPostProcessor</code>进行扩展，并新增了<code>ApplicationContextInitializer</code>和<code>ApplicationListener</code>进行扩展。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h2><p><a href="https://www.jianshu.com/p/83693d3d0a65" target="_blank" rel="external">给你一份Spring Boot知识清单</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://blogxin.cn/2019/02/06/spring-boot-init/" data-id="ck9txwat9004ojar0hu8t0f47" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACIUlEQVR42u3aQZKDMAwEwP3/p7MPSMLOyGGrYrdPFBBCc1BJln5+4vV4Ws9X8zPXx8+//djCwMD4Wsbjcs0Y1/+Sf6bk3TAwMM5hvHt0Gxbbq+/O5O+GgYGBcZ3qXQfKPJgmJAwMDIxPMdbxGBgYGCtFbFKyrm+03V6LY2BgfCEj33X//+Nb+hsYGBhfxXiU6770MQ+yL56DgYGxNWPWgJwh8wbDsCGKgYGxNSNpMbYPTYYzZq2C6K0wMDAOYNwx1JXcOUs9MTAwzmHkoW022pWE4PyzYmBgnMNoA+IdqV4LeFuFY2BgbMpoN/ET0qzQbYP7cF8QAwPjCxl5SF1pWyYtgTbov0gNMTAwNmXkhWI+NpG3KlveUicWAwNjI0ab6s2u5qMYRUqKgYGxNWNl6y0JzSvJ37AHi4GBsRFj1gBYOf5sC6FuYWJgYGzBmG2ctYlm3iiNGpwYGBgHMFpSOyTRvlb9cTEwMLZm5G2ANu2bJXwrZS0GBsbejDbty8+vlLX1qAcGBsYxjDoJGw1PJKVvPYSBgYFxACPfuB+OQSwMdiRhHQMDY1fGo1z5QNhs8CJvSGBgYJzDmAW7tvjMW56zohoDA+MExizIrmz3t58seiYGBsYBjHZDP28VtJ9ghsTAwMDI07VZAM2f/MemGwYGBkYwJJEUt+3QRnQnBgbGAYz85dYD66dGOjAwMM5h5D/L78kDbhLuk009DAyMTRm/WwOJhzSxh9IAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/Spring/">Spring</a><a href="/tags/SpringBoot/">SpringBoot</a></div><div class="post-nav"><a class="pre" href="/2019/03/02/multi-datacenter/">多活架构思考总结</a><a class="next" href="/2018/11/15/OOM-killer/">线上Java进程消失排查分析</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: '530c0141e83989b1dc02',
  clientSecret: '89e61ba0adc9b0c630bcc2641c791bfd7ef9faea',
  repo: 'kris-liu.github.io',
  owner: 'kris-liu',
  admin: ['kris-liu'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blogxin.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Concurrent/">Concurrent</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IO-NIO/">IO&NIO</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MQ/">MQ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Netty/">Netty</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat/">Tomcat</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/线上问题/">线上问题</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/内存泄漏/" style="font-size: 15px;">内存泄漏</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/GC/" style="font-size: 15px;">GC</a> <a href="/tags/线上问题/" style="font-size: 15px;">线上问题</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/IO/" style="font-size: 15px;">IO</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/并发/" style="font-size: 15px;">并发</a> <a href="/tags/锁/" style="font-size: 15px;">锁</a> <a href="/tags/源码/" style="font-size: 15px;">源码</a> <a href="/tags/Transaction/" style="font-size: 15px;">Transaction</a> <a href="/tags/异步/" style="font-size: 15px;">异步</a> <a href="/tags/读写锁/" style="font-size: 15px;">读写锁</a> <a href="/tags/缓存/" style="font-size: 15px;">缓存</a> <a href="/tags/线程池/" style="font-size: 15px;">线程池</a> <a href="/tags/BIO/" style="font-size: 15px;">BIO</a> <a href="/tags/AIO/" style="font-size: 15px;">AIO</a> <a href="/tags/JMM/" style="font-size: 15px;">JMM</a> <a href="/tags/内存模型/" style="font-size: 15px;">内存模型</a> <a href="/tags/Netty/" style="font-size: 15px;">Netty</a> <a href="/tags/Tomcat/" style="font-size: 15px;">Tomcat</a> <a href="/tags/MQ/" style="font-size: 15px;">MQ</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/MyBatis/" style="font-size: 15px;">MyBatis</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/04/Distributed-Transaction-2/">从零开始写一个分布式事务框架(二)-架构</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/16/Distributed-Transaction-1/">从零开始写一个分布式事务框架(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/01/sharding-db/">基于Spring+MyBatis实现一个分库分表、读写分离功能的工具库</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/02/multi-datacenter/">多活架构思考总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/06/spring-boot-init/">SpringBoot启动流程解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/15/OOM-killer/">线上Java进程消失排查分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/30/Distributed-Consistency/">分布式系统数据一致性问题常见解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/kafka-block/">由一次kafka消费端消息阻塞问题分析kafka消费端线程模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/29/TransactionMessage/">事务消息实现原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/23/Distributed-Transaction/">分布式事务</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.csdn.net/xx_ytm" title="我的CSDN博客" target="_blank">我的CSDN博客</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">佑祺's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>